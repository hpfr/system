" -*- mode: vimrc -*-

" " don't persist interactive changes, this config is the source of truth
" " this is asynchronous and can potentially clobber following settings, so I
" " guess I'll just have to remember to run it occasionally on close
" sanitize tridactyllocal

set editorcmd $EDITOR

colors midnight

" Binds
bind J tabnext
bind K tabprev
bind gb fillcmdline bmarks
" I don't use the home command this overwrites
bind gh fillcmdline goto
" open links in new tabs in foreground rather than background
bind F hint -t

" default bookmark storage to the Mobile Bookmarks folder since the default
" can't be changed on iOS. replace slashes in title to prevent tridactyl seeing
" them as path separators
bind a composite js document.location.href + ' /Mobile Bookmarks/' + document.title.replace(new RegExp('/','g'), 'Ôºè') | fillcmdline_notrail bmark

" make tab completion based on last visited to match the Firefox setting
set tabsort mru

" Allow Ctrl-a to select all in the commandline
unbind --mode=ex <C-a>

" Allow Ctrl-c to copy in the commandline
unbind --mode=ex <C-c>

" Handy multiwindow/multitasking binds
bind gd tabdetach
bind gD composite tabduplicate | tabdetach

" workaround to let hint -; be used with composite which uses semicolons as syntax
command hint_focus hint -;

" toggle comment view for common link aggregators
bind ;c hint -Jc summary,[class*='expand'],[class*='togg'],[aria-label='Collapse'],[class='comment_folder']

" site-specific

set searchurls.wk https://en.wikipedia.org/w/index.php?title=Special%3ASearch&search=
set searchurls.wb https://web.archive.org/web/*/
set searchurls.hn https://hn.algolia.com/?q=
set searchurls.rd https://old.reddit.com/search?q=
set searchurls.yt https://www.youtube.com/results?search_query=
set searchurls.gen https://genius.com/search?q=
set searchurls.man https://www.mankier.com/?q=
set searchurls.nxo https://search.nixos.org/options?channel=unstable&query=
set searchurls.nxp https://search.nixos.org/packages?channel=unstable&query=
set searchurls.nxpr https://nixpk.gs/pr-tracker.html?pr=

" shortcuts to search for the current page's URL on link aggregators and the
" wayback machine
command canon_fallback js document.querySelector("link[rel='canonical']")?.getAttribute("href") || document.location.href
bind gsw composite canon_fallback | open wb
bind gsh composite canon_fallback | tabopen hn
bind gsr composite canon_fallback | tabopen rd

seturl ^moz-extension://b2a9b85a-18a4-419b-9e51-22e80fca4c2a/static/docs/modules/_src_excmds_.html gotoselector h1,h2,h3

" Nixpkgs PR tracker straight from PR
bindurl ^https?://github.com/NixOS/nixpkgs/pull/\d gop composite js document.location.pathname.split('/')[4] | open nxpr

source $XDG_CONFIG_HOME/tridactyl/privaterc
